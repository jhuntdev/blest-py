{"ast":null,"code":"var _jsxFileName = \"/Users/admin/srv/flex-js/examples/client/react/src/flex-react.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$(),\n  _s4 = $RefreshSig$();\nimport { useState, useEffect, useRef, createContext, useContext, useCallback } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FlexContext = /*#__PURE__*/createContext();\nexport const FlexProvider = _ref => {\n  _s();\n  let {\n    children,\n    url,\n    options = {}\n  } = _ref;\n  const [queue, setQueue] = useState([]);\n  const [state, setState] = useState({});\n  const timeout = useRef();\n  const enqueue = useCallback((id, name, variables, options) => {\n    if (timeout.current) clearTimeout(timeout.current);\n    setState(state => {\n      return {\n        ...state,\n        [id]: {\n          loading: false,\n          error: null,\n          data: null\n        }\n      };\n    });\n    setQueue(queue => [...queue, [id, name, variables, options]]);\n  }, []);\n  useEffect(() => {\n    if (queue.length > 0) {\n      const myQueue = queue.map(q => [...q]);\n      const requestIds = queue.map(q => q[0]);\n      setQueue([]);\n      timeout.current = setTimeout(() => {\n        setState(state => {\n          const newState = {\n            ...state\n          };\n          for (let i = 0; i < requestIds.length; i++) {\n            const id = requestIds[i];\n            newState[id] = {\n              loading: true,\n              error: null,\n              data: null\n            };\n          }\n          return newState;\n        });\n        fetch(url, {\n          ...options,\n          body: JSON.stringify(myQueue),\n          mode: 'cors',\n          method: 'POST',\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        }).then(async result => {\n          const results = await result.json();\n          setState(state => {\n            const newState = {\n              ...state\n            };\n            for (let i = 0; i < results.length; i++) {\n              const item = result[i];\n              console.log(item);\n              newState[item[0]] = {\n                loading: false,\n                error: result[3],\n                data: result[2]\n              };\n            }\n            return newState;\n          });\n        }).catch(error => {\n          setState(state => {\n            const newState = {\n              ...state\n            };\n            for (let i = 0; i < myQueue.length; i++) {\n              const item = myQueue[i];\n              console.log(item);\n              newState[item[0]] = {\n                loading: false,\n                error: error,\n                data: null\n              };\n            }\n            return newState;\n          });\n        });\n      }, 1);\n    }\n  }, [queue, url, options]);\n  return /*#__PURE__*/_jsxDEV(FlexContext.Provider, {\n    value: {\n      queue,\n      state,\n      enqueue\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n_s(FlexProvider, \"mBYkQWTTurMinYl6WMCQZQsZys8=\");\n_c = FlexProvider;\nexport const useFlexContext = () => {\n  _s2();\n  const context = useContext(FlexContext);\n  useEffect(() => {\n    console.warn('useFlexContext() is a utility function for debugging');\n  }, []);\n  return context;\n};\n_s2(useFlexContext, \"wqnYpdjMkT3eDhbBjwDmfBO/TFg=\");\nexport const useFlexRequest = (name, variables, options) => {\n  _s3();\n  const {\n    state,\n    enqueue\n  } = useContext(FlexContext);\n  const [requestId, setRequestId] = useState(null);\n  const queryState = requestId && state[requestId];\n  const lastRequest = useRef();\n  useEffect(() => {\n    const requestHash = name + JSON.stringify(variables || {});\n    if (lastRequest.current === requestHash) return;\n    lastRequest.current = requestHash;\n    const id = Math.round(Math.random() * 1000000).toString();\n    enqueue(id, name, variables, options);\n    setRequestId(id);\n  }, [name, variables, options, enqueue]);\n  return queryState || {};\n};\n_s3(useFlexRequest, \"tvUzPbx6whaHAnCm4olgYtoZgQk=\");\nexport const useFlexCommand = (name, options) => {\n  _s4();\n  const {\n    state,\n    enqueue\n  } = useContext(FlexContext);\n  const [requestId, setRequestId] = useState(null);\n  const queryState = requestId && state[requestId];\n  const request = useCallback(variables => {\n    const id = Math.round(Math.random() * 1000000).toString();\n    enqueue(id, name, variables, options);\n    setRequestId(id);\n  }, [name, options, enqueue, setRequestId]);\n  return [request, queryState || {}];\n};\n_s4(useFlexCommand, \"yXByavvjwL9+LEBdvQ1zFKv6ZGs=\");\nvar _c;\n$RefreshReg$(_c, \"FlexProvider\");","map":{"version":3,"names":["useState","useEffect","useRef","createContext","useContext","useCallback","jsxDEV","_jsxDEV","FlexContext","FlexProvider","_ref","_s","children","url","options","queue","setQueue","state","setState","timeout","enqueue","id","name","variables","current","clearTimeout","loading","error","data","length","myQueue","map","q","requestIds","setTimeout","newState","i","fetch","body","JSON","stringify","mode","method","headers","then","result","results","json","item","console","log","catch","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useFlexContext","_s2","context","warn","useFlexRequest","_s3","requestId","setRequestId","queryState","lastRequest","requestHash","Math","round","random","toString","useFlexCommand","_s4","request","$RefreshReg$"],"sources":["/Users/admin/srv/flex-js/examples/client/react/src/flex-react.js"],"sourcesContent":["import { useState, useEffect, useRef, createContext, useContext, useCallback } from 'react'\n\nconst FlexContext = createContext()\n\nexport const FlexProvider = ({ children, url, options = {} }) => {\n\n  const [queue, setQueue] = useState([])\n  const [state, setState] = useState({})\n\n  const timeout = useRef()\n\n  const enqueue = useCallback((id, name, variables, options) => {\n    if (timeout.current) clearTimeout(timeout.current)\n    setState((state) => {\n      return {\n        ...state,\n        [id]: {\n          loading: false,\n          error: null,\n          data: null\n        }\n      }\n    })\n    setQueue((queue) => [...queue, [id, name, variables, options]])\n  }, [])\n  \n  useEffect(() => {\n    if (queue.length > 0) {\n      const myQueue = queue.map((q) => [...q])\n      const requestIds = queue.map((q) => q[0])\n      setQueue([])\n      timeout.current = setTimeout(() => {\n        setState((state) => {\n          const newState = {\n            ...state\n          }\n          for (let i = 0; i < requestIds.length; i++) {\n            const id = requestIds[i]\n            newState[id] = {\n              loading: true,\n              error: null,\n              data: null\n            }\n          }\n          return newState\n        })\n        fetch(url, {\n          ...options,\n          body: JSON.stringify(myQueue),\n          mode: 'cors',\n          method: 'POST',\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        })\n        .then(async (result) => {\n          const results = await result.json()\n          setState((state) => {\n            const newState = {\n              ...state\n            }\n            for (let i = 0; i < results.length; i++) {\n              const item = result[i]\n              console.log(item)\n              newState[item[0]] = {\n                loading: false,\n                error: result[3],\n                data: result[2]\n              }\n            }\n            return newState\n          })\n        })\n        .catch((error) => {\n          setState((state) => {\n            const newState = {\n              ...state\n            }\n            for (let i = 0; i < myQueue.length; i++) {\n              const item = myQueue[i]\n              console.log(item)\n              newState[item[0]] = {\n                loading: false,\n                error: error,\n                data: null\n              }\n            }\n            return newState\n          })\n        })\n      }, 1)\n    }\n  }, [queue, url, options])\n\n  return (\n    <FlexContext.Provider value={{ queue, state, enqueue }}>\n      {children}\n    </FlexContext.Provider>\n  )\n\n}\n\nexport const useFlexContext = () => {\n\n  const context = useContext(FlexContext)\n\n  useEffect(() => {\n    console.warn('useFlexContext() is a utility function for debugging')\n  }, [])\n\n  return context\n\n}\n\nexport const useFlexRequest = (name, variables, options) => {\n\n  const { state, enqueue } = useContext(FlexContext)\n  const [requestId, setRequestId] = useState(null)\n  const queryState = requestId && state[requestId]\n  const lastRequest = useRef()\n\n  useEffect(() => {\n    const requestHash = name + JSON.stringify(variables || {})\n    if (lastRequest.current === requestHash) return;\n    lastRequest.current = requestHash\n    const id = Math.round(Math.random() * 1000000).toString()\n    enqueue(id, name, variables, options)\n    setRequestId(id)\n  }, [name, variables, options, enqueue])\n\n  return queryState || {}\n\n}\n\nexport const useFlexCommand = (name, options) => {\n  \n  const { state, enqueue } = useContext(FlexContext)\n  const [requestId, setRequestId] = useState(null)\n  const queryState = requestId && state[requestId]\n\n  const request = useCallback((variables) => {\n    const id = Math.round(Math.random() * 1000000).toString()\n    enqueue(id, name, variables, options)\n    setRequestId(id)\n  }, [name, options, enqueue, setRequestId])\n\n  return [request, queryState || {}]\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}